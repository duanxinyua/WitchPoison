# 女巫的毒药 🧙‍♀️

> 游戏规则说明  
> 日期：2025-07-18  

---

## 🎮 游戏简介

"女巫的毒药"是一款基于回合制的心理博弈类小游戏，支持2-5人在线对战。每位玩家需要在一片神秘网格中秘密放置毒药，并通过轮流翻格子的方式寻找安全区域，翻到毒药则被判定失败。

---

## 📐 游戏场地

- 默认格子大小为 **5x5**
- 可由创建房间的玩家（房主）自定义格子大小（5x5 到 10x10）和游戏人数（2-5人）

---

## 👥 玩家人数

- 支持 **2-5人** 的对战模式
- 多人参与时，**仅剩一人未中毒**即视为胜利

---

## 🔁 游戏流程

### 1. 放置毒药
- 每位玩家在格子中**秘密放置**一枚毒药
- 所放位置对其他玩家**不可见**

### 2. 轮流翻格子
- 玩家依次选择尚未翻开的格子进行探索
- 翻开后显示该格子是否安全或含毒药

### 3. 游戏结束
- 若翻开**任意毒药**（包括自己的），即视为被毒，游戏结束
- **最后幸存的玩家获胜**

---

## ⚠️ 游戏要点

- 玩家**不能翻开已翻开的格子**
- 理论上玩家不应翻到自己的毒药（除非失误）
- 游戏流程依赖回合顺序进行操作
- 当前版本**不支持观战或回放功能**

---

## 🧩 技术架构说明

| 层级 | 技术栈             |
|------|--------------------|
| 前端 | UniApp + Vue 3     |
| 后端 | Node.js + Express + WebSocket（内存存储） |
| 部署 | 宝塔面板 + Nginx（含 SSL / 反代） |

---

## 🚀 开发运行

### 前端开发
```bash
cd poison-game
npm install
npm run dev:mp-weixin    # 微信小程序开发
npm run build:mp-weixin  # 微信小程序构建
```

### 后端开发
```bash
cd poison-game-backend
npm install
npm start               # 启动服务器(端口3000)
```

---

## 📅 更新记录

### v1.2.1 (2025-07-31)

#### 🔧 配置系统重构
- **统一配置管理**：删除.env文件，采用单一配置文件`config/index.js`，便于后期域名修改
- **Vue 3完整迁移**：将游戏核心组件GameGrid.vue和game.vue从Vue 2选项式API完整重构为Vue 3 Composition API
- **依赖清理优化**：移除dotenv等不必要依赖，简化package.json和构建脚本

#### 🎮 游戏体验优化
- **WebSocket连接修复**：解决因环境变量问题导致的WebSocket连接失败
- **组件响应式改进**：使用Vue 3的ref()和reactive()优化游戏状态管理
- **错误提示友好化**：将技术错误信息改为用户友好的状态提示

#### 🛠️ 技术架构现代化
- **Composition API全面应用**：使用setup()、onMounted()、onUnmounted()等现代Vue 3特性
- **导入路径修复**：统一模块导入路径，确保跨平台编译兼容性
- **manifest配置更新**：正确设置Vue版本为3，移除小程序特定配置

### v1.2.0 (2025-07-30)

#### 🎨 个性化设置功能重大修复
- **头像选择界面**：修复头像页面布局错误，从单列显示修复为6行5列正确网格布局
- **个性化弹窗**：修复头像选择后弹窗中显示不更新的问题，实现实时预览效果
- **保存逻辑优化**：修复点击"跳过"仍会保存头像的逻辑错误，只有"保存设置"才真正保存

#### 🔧 技术架构升级
- **Vue 3迁移**：将首页从Vue 2选项式API重构为Vue 3 Composition API，提升性能和维护性
- **临时预览机制**：实现头像临时存储和预览功能，用户体验更流畅
- **跨页面同步**：使用定时器轮询方案解决小程序环境下的状态同步问题

#### 🛠️ 代码质量提升
- **资源管理**：添加完善的定时器清理和事件监听管理，避免内存泄漏
- **异常处理**：优化小程序环境下的变量访问和错误处理机制
- **交互简化**：优化头像选择流程，移除确认按钮，选择即返回

### v1.1.0 (2025-07-19)

#### 🎨 UI体验优化
- **个性化设置界面**：重新设计表单布局，优化对齐和响应式设计
- **用户信息显示**：调整头像位置至名称右侧，实现居中对齐，缩小个性化按钮
- **表单组件**：统一按钮样式、间距和交互效果，增强视觉层次感

#### 🔧 核心功能修复  
- **TypeError dirty错误**：修复GameGrid组件中的Vue数据绑定问题，添加安全检查和异常处理
- **默认用户信息**：优化昵称和头像保存逻辑，首次进入自动生成并持久化，避免重复刷新

#### 🚀 用户体验提升
- **WeChat合规**：实现游客模式，允许用户先体验游戏再设置个人信息
- **数据持久化**：确保用户信息在页面切换间保持一致，提升使用连续性
- **响应式设计**：优化小屏幕显示效果，确保各设备兼容性

#### 🛠️ 技术改进
- **组件生命周期**：优化Vue组件挂载和数据更新机制
- **异常处理**：增强错误捕获和用户友好的提示信息
- **代码质量**：统一代码风格，提升可维护性

### v1.0.0 (2025-07-18)
- **项目文档**：完善项目文档，添加开发运行说明
- **技术架构**：更新技术架构描述，明确Vue 3和Express框架
- **规范说明**：规范玩家人数和棋盘大小限制说明
- **开发指南**：添加前后端开发命令指南

### v0.1.0 (2025-06-12)
- **项目初始化**：编写并确认游戏规则，初始化开发框架结构（UniApp + WebSocket）

---

